<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autonomous Parafoil Project - Thomas Tran</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #d1d5db;
        }
        .content-section {
            background-color: #1f2937;
            border: 1px solid #374151;
        }
        h2 {
            border-bottom: 2px solid #38bdf8; /* sky-400 */
            padding-bottom: 0.5rem;
        }
        .btn {
            transition: background-color 0.3s ease, transform 0.3s ease;
        }
        .btn:hover {
            transform: scale(1.05);
        }
        /* Architecture Diagram Styles */
        .arch-box {
            background: rgba(31, 41, 55, 0.8);
            border: 1px solid #4b5563;
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
            transition: all 0.3s ease;
        }
        .arch-box:hover {
            border-color: #38bdf8;
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.2);
        }
        .arrow-down {
            width: 2px;
            height: 20px;
            background: #4b5563;
            margin: 0 auto;
            position: relative;
        }
        .arrow-down::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: -4px;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 5px solid #4b5563;
        }
        
        /* --- PCB Grid & Lightbox Styles --- */
        .pcb-grid-item {
            position: relative;
            overflow: hidden;
            border-radius: 0.5rem;
            border: 1px solid #4b5563;
            background-color: #111827; /* Dark background for circular PCBs */
            cursor: pointer;
            group: true; /* For Tailwind group-hover */
        }
        
        /* Fixes cropping: Shows full image */
        .pcb-grid-item img {
            transition: transform 0.5s ease, opacity 0.3s ease;
            width: 100%;
            height: 100%;
            object-fit: contain; /* CRITICAL: Ensures no cropping */
        }
        
        /* Zoom effect on hover */
        .pcb-grid-item:hover img {
            transform: scale(1.05);
            opacity: 0.8;
        }

        /* Overlay icon on hover */
        .zoom-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.4);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .pcb-grid-item:hover .zoom-overlay {
            opacity: 1;
        }

        .pcb-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(17, 24, 39, 0.9);
            color: #e5e7eb;
            font-size: 0.75rem;
            padding: 0.5rem;
            text-align: center;
            border-top: 1px solid #374151;
        }

        /* Lightbox Modal */
        #lightbox {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        #lightbox.active {
            opacity: 1;
            pointer-events: auto;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-12">

        <!-- Project Header -->
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-white">Autonomous Parafoil Guidance & Control System</h1>
            <p class="mt-2 text-lg text-sky-300">A custom PCB-based GNC system for precision payload recovery.</p>
            <div class="mt-4 flex justify-center space-x-4">
                <span class="bg-green-900 text-green-300 text-xs font-semibold px-3 py-1 rounded-full"><i class="fas fa-check-circle mr-1"></i>Flight Proven</span>
                <span class="bg-sky-900 text-sky-300 text-xs font-semibold px-3 py-1 rounded-full">STM32H7</span>
                <span class="bg-purple-900 text-purple-300 text-xs font-semibold px-3 py-1 rounded-full">Altium Designer</span>
            </div>
        </header>

        <div class="space-y-12">

            <!-- Project Overview -->
            <section class="content-section p-6 rounded-lg">
                <h2 class="text-3xl font-bold mb-4 text-white">Project Overview</h2>
                <div class="md:flex md:space-x-8 items-center">
                    <div class="md:w-2/3 text-lg leading-relaxed">
                        <p>This project involved designing, building, and validating an autonomous guidance unit (AGU) capable of navigating a 5kg payload to a designated GPS coordinate. The system was designed to address the problem of recovering high-altitude scientific payloads, which often drift off-course during descent.</p>
                        <p class="mt-4">The final system features a custom 4-layer PCB, a high-fidelity sensor suite, and a robust Guidance, Navigation, and Control (GNC) algorithm. During final field testing, the system successfully navigated from a drop height of 75 meters to land within <span class="text-sky-300 font-bold">5 meters</span> of the target coordinate.</p>
                    </div>
                    <div class="md:w-1/3 mt-6 md:mt-0">
                        <img src="assets/images/pcbstructure.jpg" alt="Final Assembly" class="rounded-lg shadow-lg w-full object-cover h-64 border border-gray-600">
                        <p class="text-center text-sm mt-2 text-gray-400">The final AGU assembly showing the servo actuation system and parachute rigging.</p>
                    </div>
                </div>
            </section>

            <!-- Flight Demonstration (New Section) -->
            <section class="content-section p-6 rounded-lg border-t-4 border-green-500">
                <h2 class="text-3xl font-bold mb-6 text-white"><i class="fas fa-video mr-3 text-green-400"></i>Flight Demonstration</h2>
                <p class="text-lg text-gray-300 mb-6">On December 6, 2025, the system was validated in a live field test. Despite winter conditions, the AGU successfully steered the parafoil to the target landing zone.</p>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Video 1: The Descent -->
                    <div class="bg-gray-800 p-4 rounded-xl shadow-lg border border-gray-700">
                        <div class="relative w-full pb-[177.78%] lg:pb-[56.25%] overflow-hidden rounded-lg bg-black">
                            <!-- Using style to force aspect ratio for vertical video if needed, or standard -->
                            <video controls playsinline class="absolute top-0 left-0 w-full h-full object-contain">
                                <source src="assets/videos/parafoil_flight.mp4" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        </div>
                        <div class="mt-4">
                            <h3 class="text-xl font-bold text-white">Autonomous Descent</h3>
                            <p class="text-sm text-gray-400 mt-1">
                                <span class="text-sky-400 font-semibold">Altitude:</span> 75m Drop<br>
                                <span class="text-sky-400 font-semibold">Action:</span> The AGU detects freefall, deploys the parafoil, and begins actuating control lines to correct heading against the wind.
                            </p>
                        </div>
                    </div>

                    <!-- Video 2: The Landing -->
                    <div class="bg-gray-800 p-4 rounded-xl shadow-lg border border-gray-700">
                        <div class="relative w-full pb-[56.25%] overflow-hidden rounded-lg bg-black">
                            <video controls playsinline class="absolute top-0 left-0 w-full h-full object-contain">
                                <source src="assets/videos/parafoil_landing.mp4" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        </div>
                        <div class="mt-4">
                            <h3 class="text-xl font-bold text-white">Precision Landing</h3>
                            <p class="text-sm text-gray-400 mt-1">
                                <span class="text-sky-400 font-semibold">Result:</span> < 5m from target center.<br>
                                <span class="text-sky-400 font-semibold">Outcome:</span> Successful autonomous flare and touchdown, followed by team celebration.
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- PCB Design Spotlight -->
            <section class="content-section p-6 rounded-lg">
                <h2 class="text-3xl font-bold mb-6 text-white text-center">Custom PCB Architecture</h2>
                
                <div class="flex flex-col lg:flex-row gap-8">
                    
                    <!-- Left Column: Design Gallery (2x2 Grid) -->
                    <div class="lg:w-1/2">
                        <div class="grid grid-cols-2 gap-4">
                            <!-- Design Phase -->
                            <div class="pcb-grid-item h-48" onclick="openLightbox('assets/images/pcb_design_3d.png', 'Altium 3D Render')">
                                <img src="assets/images/pcb_design_3d.png" alt="Altium 3D Render">
                                <div class="zoom-overlay"><i class="fas fa-search-plus text-3xl text-white"></i></div>
                                <div class="pcb-caption">Altium 3D Render</div>
                            </div>
                            <div class="pcb-grid-item h-48" onclick="openLightbox('assets/images/pcb_design_layout.jpg', 'Routing Topology (2oz Copper)')">
                                <img src="assets/images/pcb_design_layout.jpg" alt="Altium Layout Routing">
                                <div class="zoom-overlay"><i class="fas fa-search-plus text-3xl text-white"></i></div>
                                <div class="pcb-caption">Routing Topology</div>
                            </div>
                            
                            <!-- Build Phase -->
                            <div class="pcb-grid-item h-48" onclick="openLightbox('assets/images/pcbimage1.jpg', 'Assembled PCB - Top View')">
                                <img src="assets/images/pcbimage1.jpg" alt="Assembled Top">
                                <div class="zoom-overlay"><i class="fas fa-search-plus text-3xl text-white"></i></div>
                                <div class="pcb-caption">Assembled Top</div>
                            </div>
                            <div class="pcb-grid-item h-48" onclick="openLightbox('assets/images/pcbimage2.jpg', 'Assembled PCB - Bottom View')">
                                <img src="assets/images/pcbimage2.jpg" alt="Assembled Bottom">
                                <div class="zoom-overlay"><i class="fas fa-search-plus text-3xl text-white"></i></div>
                                <div class="pcb-caption">Assembled Bottom</div>
                            </div>
                        </div>
                        <p class="text-center text-xs text-gray-500 mt-3 italic"><i class="fas fa-mouse-pointer mr-1"></i> Click any image to enlarge</p>
                    </div>
                    
                    <!-- Right Column: Technical Details -->
                    <div class="lg:w-1/2 space-y-6 flex flex-col justify-center">
                        <div>
                            <h3 class="text-xl font-bold text-sky-400 mb-2">Layer Stackup & Signal Integrity</h3>
                            <p class="text-gray-300">Designed a custom 4-layer PCB in Altium Designer using a <span class="text-white font-semibold">Ground-Signal-Power-Ground</span> stackup. This configuration shields sensitive internal signal traces from external EMI, crucial for the high-frequency GPS and RF modules. I utilized <span class="text-white font-semibold">2oz copper</span> for internal layers to handle high current density from the servo motors and minimize resistive heating.</p>
                        </div>

                        <div>
                            <h3 class="text-xl font-bold text-sky-400 mb-2">Power Distribution Network</h3>
                            <p class="text-gray-300">Implemented a <span class="text-white font-semibold">"Star Routing" topology</span> to isolate the noisy high-current servo power rails from the sensitive 3.3V logic rails. This prevents voltage drops and ground bounce caused by servo stall currents from resetting the microcontroller.</p>
                        </div>

                        <div>
                            <h3 class="text-xl font-bold text-sky-400 mb-2">RF & Component Integration</h3>
                            <ul class="list-disc list-inside text-gray-300 space-y-2 text-sm">
                                <li><strong>MCU:</strong> STM32H7 High-Performance Microcontroller.</li>
                                <li><strong>GPS:</strong> Integrated NEO-M9N module with a custom bias-tee circuit (27nH inductor + 100nF cap network) to inject DC power into the active antenna while isolating the RF path.</li>
                                <li><strong>Sensors:</strong> BNO085 9-Axis IMU for attitude estimation.</li>
                                <li><strong>Protection:</strong> Reverse polarity protection via Schottky diodes and dedicated status LEDs for all power rails.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Firmware & Control -->
            <section class="content-section p-6 rounded-lg">
                <h2 class="text-3xl font-bold mb-6 text-white">Firmware & Autonomy</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="text-lg leading-relaxed flex flex-col justify-between">
                        <div>
                            <h3 class="text-2xl font-semibold text-sky-300 mb-3">FreeRTOS Architecture</h3>
                            <p class="mb-4 text-gray-300">
                                The firmware operates on an STM32H7, utilizing FreeRTOS to manage the asynchronous nature of sensor data. The system is architected into three primary prioritized tasks:
                            </p>
                            <ul class="list-disc list-inside space-y-2 text-gray-300 mb-6 pl-2">
                                <li><strong class="text-white">Startbno085 (High Priority):</strong> Polls IMU data at 100Hz via a custom SPI driver. It handles the SHTP protocol's fragmentation and reassembly to ensure zero data loss.</li>
                                <li><strong class="text-white">readGPS (DMA-Driven):</strong> Parses binary UBX GPS packets using Direct Memory Access (DMA). This allows extraction of precise velocity vectors without blocking the CPU, unlike standard NMEA parsing.</li>
                                <li><strong class="text-white">Telemetry & Control:</strong> Manages XBee communication and servo PWM generation in a lower-priority thread to maintain control loop stability.</li>
                            </ul>

                            <h3 class="text-2xl font-semibold text-sky-300 mb-3">Extended Kalman Filter (EKF)</h3>
                            <p class="text-gray-300 mb-4">
                                I implemented a <strong>7-state EKF</strong> (tracking Position N/E/D, Velocity N/E/D, and Heading Bias) to fuse the 100Hz inertial data with lower-frequency GPS updates. To optimize for the microcontroller, I developed a <strong>Sequential Update</strong> method, processing GPS scalars independently to avoid computationally expensive 7x7 matrix inversions.
                            </p>
                            
                            <div class="bg-red-900/30 border border-red-700/50 p-3 rounded mt-2">
                                <h4 class="text-red-300 font-bold text-sm"><i class="fas fa-exclamation-triangle mr-2"></i>Safety Systems</h4>
                                <p class="text-gray-400 text-xs mt-1">Includes a "Deadspin" failsafe mode that forces a spiral descent if critical sensors fail or the geofence is breached.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Control Loop Visualization -->
                    <div class="flex flex-col justify-center h-full">
                        <div class="bg-gray-800/50 p-6 rounded-xl border border-gray-700 relative overflow-hidden">
                            <!-- Header -->
                            <div class="text-center mb-6">
                                <h4 class="text-white font-bold text-lg">System Control Loop</h4>
                                <p class="text-xs text-gray-500">100Hz Real-Time Execution</p>
                            </div>

                            <!-- Diagram Flow -->
                            <div class="space-y-2">
                                <!-- Inputs -->
                                <div class="flex justify-between gap-2">
                                    <div class="arch-box w-1/2">
                                        <i class="fas fa-microchip text-sky-400 mb-1 text-2xl"></i>
                                        <div class="text-white font-bold text-sm">IMU (BNO085)</div>
                                        <div class="text-xs text-gray-400">100Hz SPI Stream</div>
                                    </div>
                                    <div class="arch-box w-1/2">
                                        <i class="fas fa-satellite text-sky-400 mb-1 text-2xl"></i>
                                        <div class="text-white font-bold text-sm">GPS (NEO-M9)</div>
                                        <div class="text-xs text-gray-400">5Hz UBX / DMA</div>
                                    </div>
                                </div>

                                <!-- Arrow -->
                                <div class="arrow-down"></div>

                                <!-- Processor -->
                                <div class="arch-box border-sky-500/50 bg-sky-900/10">
                                    <i class="fas fa-brain text-purple-400 mb-2 text-2xl"></i>
                                    <div class="text-white font-bold">STM32H7 Core</div>
                                    <div class="my-2 border-t border-gray-600"></div>
                                    <div class="grid grid-cols-2 gap-2 text-xs">
                                        <div class="bg-gray-900/80 p-2 rounded text-green-300">
                                            <strong>EKF Fusion</strong><br>State Estimation
                                        </div>
                                        <div class="bg-gray-900/80 p-2 rounded text-blue-300">
                                            <strong>GNC Logic</strong><br>Path Planning
                                        </div>
                                    </div>
                                </div>

                                <!-- Arrow -->
                                <div class="arrow-down"></div>

                                <!-- Outputs -->
                                <div class="flex justify-between gap-2">
                                    <div class="arch-box w-full">
                                        <i class="fas fa-gears text-orange-400 mb-1 text-2xl"></i>
                                        <div class="text-white font-bold text-sm">Servo Actuation</div>
                                        <div class="text-xs text-gray-400">PWM Output (TIM2)</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Decor -->
                            <div class="absolute top-0 right-0 p-4 opacity-10">
                                <i class="fas fa-code text-6xl text-white"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Project Documents -->
            <section class="content-section p-6 rounded-lg">
                <h2 class="text-3xl font-bold mb-4 text-white">Project Resources</h2>
                <div class="flex flex-col md:flex-row justify-center gap-4">
                    <a href="assets/docs/EECS_473_Final_Report_Draft__1_ (1).pdf" target="_blank" class="btn bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg inline-flex items-center justify-center">
                        <i class="fas fa-file-pdf mr-3 text-red-400"></i> Read Final Report
                    </a>
                    <a href="https://github.com/mjcapo/EECS473-Parafoilers.git" target="_blank" class="btn bg-gray-800 hover:bg-gray-900 text-white font-bold py-3 px-6 rounded-lg inline-flex items-center justify-center border border-gray-600">
                        <i class="fab fa-github mr-3 text-white"></i> View Source Code
                    </a>
                </div>
            </section>

        </div>

        <!-- Back to Home Button -->
        <div class="text-center mt-16">
            <a href="index.html" class="btn bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-6 rounded-full text-lg">
                <i class="fas fa-arrow-left mr-2"></i> Back to Portfolio
            </a>
        </div>
    </main>
    
    <!-- Lightbox Modal -->
    <div id="lightbox" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-95 p-4" onclick="closeLightbox()">
        <button class="absolute top-4 right-4 text-white text-4xl hover:text-sky-400">&times;</button>
        <div class="max-w-5xl w-full text-center" onclick="event.stopPropagation()"> <!-- Stop click from closing when clicking image -->
            <img id="lightbox-img" src="" alt="Full view" class="max-h-[85vh] max-w-full mx-auto rounded shadow-2xl border border-gray-700">
            <h3 id="lightbox-caption" class="text-white text-xl mt-4 font-semibold"></h3>
        </div>
    </div>

    <script>
        function openLightbox(src, caption) {
            const lightbox = document.getElementById('lightbox');
            const img = document.getElementById('lightbox-img');
            const cap = document.getElementById('lightbox-caption');
            
            img.src = src;
            cap.textContent = caption;
            lightbox.classList.add('active');
        }

        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('active');
        }

        // Close on Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === "Escape") {
                closeLightbox();
            }
        });
    </script>
</body>
</html>
